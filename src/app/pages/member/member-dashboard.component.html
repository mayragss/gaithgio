<div class="member-dashboard" *ngIf="currentUser; else loadingTemplate">
  <!-- Navbar do Dashboard -->
  <div class="dashboard-navbar">
    <div class="navbar-container">
      <div class="navbar-logo">
        <a href="/" class="logo-link">
          <img src="/images/Logotipo.png" alt="GAITHGIO" class="logo-image" />
          <span class="logo-text cinzel">GAITHGIO</span>
        </a>
      </div>
      <div class="navbar-links montserrat">
        <a href="/" class="navbar-link">
          <i class="pi pi-home"></i>
          Home
        </a>
        <a href="/products" class="navbar-link">
          <i class="pi pi-shopping-bag"></i>
          Produtos
        </a>
        <div class="navbar-profile" (click)="toggleUserMenu()">
          <i class="pi pi-user"></i>
        </div>
        @if (showUserMenu) {
          <div class="user-dropdown">
            <div class="user-info">
              <p class="user-name">{{ currentUser.firstName }} {{ currentUser.lastName }}</p>
              <p class="user-email">{{ currentUser.email }}</p>
            </div>
            <div class="dropdown-divider"></div>
            <div class="logout-option" (click)="logout()">
              <i class="pi pi-arrow-right"></i>
              <span>Sair</span>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
  
  <div class="dashboard-container" [class.orders-container]="activeTab === 'orders'">
    <!-- Secondary Navigation Menu -->
    <div class="dashboard-tabs">
      <button 
        class="tab-item" 
        [class.active]="activeTab === 'profile'"
        (click)="setActiveTab('profile')">
        <i class="pi pi-user"></i>
        <span class="montserrat">Perfil</span>
      </button>
      <button 
        class="tab-item" 
        [class.active]="activeTab === 'orders'"
        (click)="setActiveTab('orders')">
        <i class="pi pi-box"></i>
        <span class="montserrat">Pedidos</span>
      </button>
      <button 
        class="tab-item" 
        [class.active]="activeTab === 'addresses'"
        (click)="setActiveTab('addresses')">
        <i class="pi pi-map-marker"></i>
        <span class="montserrat">Endere√ßos</span>
      </button>
    </div>

    <!-- Content Area -->
    <div class="dashboard-content">
      <!-- Profile Tab -->
      <div class="tab-content" *ngIf="activeTab === 'profile'">
        <div class="profile-section">
          <h2 class="section-title montserrat">Informa√ß√µes Pessoais</h2>
          <div class="profile-info">
            <div class="info-item">
              <label class="montserrat">Nome</label>
              <span class="montserrat">{{ currentUser.firstName }} {{ currentUser.lastName }}</span>
            </div>
            <div class="info-item">
              <label class="montserrat">Email</label>
              <span class="montserrat">{{ currentUser.email }}</span>
            </div>
            <div class="info-item">
              <label class="montserrat">Telefone</label>
              <span class="montserrat">{{ currentUser.phone }}</span>
            </div>
          </div>
          <button class="edit-btn montserrat" (click)="setActiveTab('edit-profile')">

            <span>Editar Perfil</span>
          </button>
        </div>
      </div>

      <!-- Orders Tab -->
      <div class="tab-content" *ngIf="activeTab === 'orders'">
        <div class="orders-section">
          <h2 class="section-title montserrat pb-4">Hist√≥rico de Pedidos</h2>
          @if (isLoadingOrders) {
            <div class="empty-state">
              <p class="montserrat">Carregando pedidos...</p>
            </div>
          } @else {
            <div class="orders-info" *ngIf="orders.length > 0; else noOrders">
              @for (order of orders; track order.id) {
              <div class="order-card">
                <div class="order-icon-circle">
                  <i class="pi pi-box"></i>
                </div>
                <div class="order-content">
                  <div class="order-number montserrat">Pedido #{{ order.orderNumber || order.id }}</div>
                  <div class="order-date montserrat">
                    <i class="pi pi-clock"></i>
                    <span>{{ formatOrderDate(order.createdAt) }}</span>
                  </div>
                  <div class="order-items montserrat">
                    {{ formatItemsText(order) }}
                  </div>
                </div>
                <div class="order-side">
                  <div class="order-status-container">
                    <span class="status-dot" [class]="'dot-' + order.status"></span>
                    <span class="order-status montserrat" [class]="'status-' + order.status">
                      {{ getStatusLabel(order.status) }}
                    </span>
                  </div>
                  <div class="order-total montserrat">R$ {{ order.total | number:'1.2-2' }}</div>
                  <div class="order-action-link">
                    <a class="conclude-link montserrat" (click)="concludeOrder(order)">
                      Concluir o Pedido
                    </a>
                  </div>
                </div>
              </div>
              }
            </div>
            <ng-template #noOrders>
              <div class="empty-state">
                <span class="empty-icon">üõçÔ∏è</span>
                <p class="montserrat">Nenhum pedido encontrado</p>
              </div>
            </ng-template>
          }
        </div>
      </div>

      <!-- Addresses Tab -->
      <div class="tab-content" *ngIf="activeTab === 'addresses'">
        <div class="addresses-header">
          <h2 class="section-title montserrat">Meus Endere√ßos</h2>
          <button class="add-address-btn montserrat" (click)="setActiveTab('add-address')">
            <span class="icon">+</span>
            Adicionar Endere√ßo
          </button>
        </div>
        <div class="addresses-list" *ngIf="currentUser.addresses.length > 0; else noAddresses">
          @for (address of currentUser.addresses; track address.id) {
          <div class="address-card">
            <div class="address-header">
              <span class="address-type montserrat">{{ getAddressTypeLabel(address.type) }}</span>
              <span class="default-badge montserrat" *ngIf="address.isDefault">Padr√£o</span>
            </div>
            <div class="address-details">
              <p class="montserrat">{{ address.street }}, {{ address.number }}</p>
              <p class="montserrat" *ngIf="address.complement">{{ address.complement }}</p>
              <p class="montserrat">{{ address.neighborhood }}</p>
              <p class="montserrat">{{ address.city }} - {{ address.state }}</p>
              <p class="montserrat">CEP: {{ address.zipCode }}</p>
            </div>
            <div class="address-actions">
              <button class="edit-address-btn montserrat" (click)="editAddress(address)">
              Editar
              </button>
            </div>
          </div>
          }
        </div>
        <ng-template #noAddresses>
          <div class="empty-state-address">
            <div class="empty-icon-circle">
              <i class="pi pi-map-marker"></i>
            </div>
            <p class="empty-title montserrat">Nenhum endere√ßo cadastrado</p>
            <p class="empty-description montserrat">Adicione um endere√ßo para facilitar suas compras futuras.</p>
          </div>
        </ng-template>
      </div>

      <!-- Edit Profile Tab -->
      <div class="tab-content" *ngIf="activeTab === 'edit-profile'">
        <h2 class="section-title montserrat">Editar Perfil</h2>
        
        <div class="success-message" *ngIf="successMessage">
          <span class="icon">‚úÖ</span>
          {{ successMessage }}
        </div>

        <form class="profile-form" (ngSubmit)="onSubmitEditProfile()">
          <div class="form-group">
            <label class="montserrat">Nome</label>
            <input type="text" class="form-input montserrat" [(ngModel)]="editForm.firstName" name="firstName" required>
          </div>
          <div class="form-group">
            <label class="montserrat">Sobrenome</label>
            <input type="text" class="form-input montserrat" [(ngModel)]="editForm.lastName" name="lastName" required>
          </div>
          <div class="form-group">
            <label class="montserrat">Email</label>
            <input type="email" class="form-input montserrat" [(ngModel)]="editForm.email" name="email" required>
          </div>
          <div class="form-group">
            <label class="montserrat">Telefone</label>
            <input type="tel" class="form-input montserrat" [(ngModel)]="editForm.phone" name="phone" required>
          </div>
          <div class="form-actions">
            <button type="button" class="cancel-btn montserrat" (click)="setActiveTab('profile')">
              Cancelar
            </button>
            <button type="submit" class="save-btn montserrat" [disabled]="isLoading">
              <span *ngIf="isLoading">‚è≥</span>
              {{ isLoading ? 'Salvando...' : 'Salvar Altera√ß√µes' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Add Address Tab -->
      <div class="tab-content" *ngIf="activeTab === 'add-address'">
        <h2 class="section-title montserrat">{{ editingAddressId ? 'Editar Endere√ßo' : 'Adicionar Endere√ßo' }}</h2>
        
        <div class="success-message" *ngIf="successMessage">
          <span class="icon">‚úÖ</span>
          {{ successMessage }}
        </div>
        
        <form class="address-form" (ngSubmit)="saveAddress()">
          <div class="form-group">
            <label class="montserrat">Tipo de Endere√ßo</label>
            <select class="form-input montserrat" [(ngModel)]="addressForm.type" name="type" required>
              <option value="residential">Residencial</option>
              <option value="commercial">Comercial</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="montserrat">Rua</label>
              <input type="text" class="form-input montserrat" [(ngModel)]="addressForm.street" name="street" required>
            </div>
            <div class="form-group">
              <label class="montserrat">N√∫mero</label>
              <input type="text" class="form-input montserrat" [(ngModel)]="addressForm.number" name="number" required>
            </div>
          </div>
          <div class="form-group">
            <label class="montserrat">Complemento</label>
            <input type="text" class="form-input montserrat" [(ngModel)]="addressForm.complement" name="complement">
          </div>
          <div class="form-group">
            <label class="montserrat">Bairro</label>
            <input type="text" class="form-input montserrat" [(ngModel)]="addressForm.district" name="district" required>
          </div>
          <div class="form-group">
            <label class="montserrat">Cidade</label>
            <input type="text" class="form-input montserrat" [(ngModel)]="addressForm.city" name="city" required>
          </div>
          <div class="form-group">
            <label class="montserrat">C√≥digo postal</label>
            <input type="text" class="form-input montserrat" [(ngModel)]="addressForm.zip" name="zip" required>
          </div>
          <div class="form-group">
            <label class="montserrat">Pa√≠s</label>
            <input type="text" class="form-input montserrat" [(ngModel)]="addressForm.country" name="country" value="Portugal" required>
          </div>
          <div class="form-actions">
            <button type="button" class="cancel-btn montserrat" (click)="setActiveTab('addresses')">
              Cancelar
            </button>
            <button type="submit" class="save-btn montserrat" [disabled]="isLoading">
              {{ isLoading ? 'Salvando...' : (editingAddressId ? 'Atualizar Endere√ßo' : 'Salvar Endere√ßo') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer></footer>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p class="montserrat">Carregando seus dados...</p>
  </div>
</ng-template>

<div class="member-dashboard" *ngIf="currentUser; else loadingTemplate">
  <div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
      <h1 class="dashboard-title cinzel">Meu Painel</h1>
      <p class="welcome-text montserrat">Bem-vindo, {{ currentUser.firstName }}!</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="dashboard-nav">
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'profile'"
        (click)="setActiveTab('profile')">
        Perfil
      </button>
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'orders'"
        (click)="setActiveTab('orders')">
        Pedidos
      </button>
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'addresses'"
        (click)="setActiveTab('addresses')">
        Endere√ßos
      </button>
      <button 
        class="nav-tab logout-btn" 
        (click)="logout()">
        Sair
      </button>
    </div>

    <!-- Content Area -->
    <div class="dashboard-content">
      <!-- Profile Tab -->
      <div class="tab-content" *ngIf="activeTab === 'profile'">
        <div class="profile-section">
          <h2 class="section-title cinzel">Informa√ß√µes Pessoais</h2>
          <div class="profile-info">
            <div class="info-item">
              <label class="montserrat">Nome:</label>
              <span class="montserrat">{{ currentUser.firstName }} {{ currentUser.lastName }}</span>
            </div>
            <div class="info-item">
              <label class="montserrat">Email:</label>
              <span class="montserrat">{{ currentUser.email }}</span>
            </div>
            <div class="info-item">
              <label class="montserrat">Telefone:</label>
              <span class="montserrat">{{ currentUser.phone }}</span>
            </div>
            <div class="info-item" *ngIf="currentUser.dateOfBirth">
              <label class="montserrat">Data de Nascimento:</label>
              <span class="montserrat">{{ currentUser.dateOfBirth | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>
          <button class="edit-btn montserrat" (click)="setActiveTab('edit-profile')">
            <span class="icon">‚úèÔ∏è</span>
            Editar Perfil
          </button>
        </div>
      </div>

      <!-- Orders Tab -->
      <div class="tab-content" *ngIf="activeTab === 'orders'">
        <h2 class="section-title cinzel">Hist√≥rico de Pedidos</h2>
        <div class="orders-list" *ngIf="currentUser.orders.length > 0; else noOrders">
          @for (order of currentUser.orders; track order.id) {
          <div class="order-card">
            <div class="order-header">
              <span class="order-number montserrat">Pedido #{{ order.orderNumber }}</span>
              <span class="order-status montserrat" [class]="'status-' + order.status">
                {{ order.status | titlecase }}
              </span>
            </div>
            <div class="order-details">
              <p class="montserrat">Data: {{ order.createdAt | date:'dd/MM/yyyy' }}</p>
              <p class="montserrat">Total: R$ {{ order.total | number:'1.2-2' }}</p>
              <p class="montserrat">Itens: {{ order.items.length }}</p>
            </div>
          </div>
          }
        </div>
        <ng-template #noOrders>
          <div class="empty-state">
            <span class="empty-icon">üõçÔ∏è</span>
            <p class="montserrat">Nenhum pedido encontrado</p>
          </div>
        </ng-template>
      </div>

      <!-- Addresses Tab -->
      <div class="tab-content" *ngIf="activeTab === 'addresses'">
        <div class="addresses-header">
          <h2 class="section-title cinzel">Meus Endere√ßos</h2>
          <button class="add-address-btn montserrat" (click)="setActiveTab('add-address')">
            <span class="icon">‚ûï</span>
            Adicionar Endere√ßo
          </button>
        </div>
        <div class="addresses-list" *ngIf="currentUser.addresses.length > 0; else noAddresses">
          @for (address of currentUser.addresses; track address.id) {
          <div class="address-card">
            <div class="address-header">
              <span class="address-type montserrat">{{ address.type | titlecase }}</span>
              <span class="default-badge montserrat" *ngIf="address.isDefault">Padr√£o</span>
            </div>
            <div class="address-details">
              <p class="montserrat">{{ address.street }}, {{ address.number }}</p>
              <p class="montserrat" *ngIf="address.complement">{{ address.complement }}</p>
              <p class="montserrat">{{ address.neighborhood }}</p>
              <p class="montserrat">{{ address.city }} - {{ address.state }}</p>
              <p class="montserrat">CEP: {{ address.zipCode }}</p>
            </div>
            <div class="address-actions">
              <button class="edit-address-btn montserrat">
              <span class="icon">‚úèÔ∏è</span>
              Editar
              </button>
            </div>
          </div>
          }
        </div>
        <ng-template #noAddresses>
          <div class="empty-state">
            <span class="empty-icon">üìç</span>
            <p class="montserrat">Nenhum endere√ßo cadastrado</p>
          </div>
        </ng-template>
      </div>

      <!-- Edit Profile Tab -->
      <div class="tab-content" *ngIf="activeTab === 'edit-profile'">
        <h2 class="section-title cinzel">Editar Perfil</h2>
        
        <div class="success-message" *ngIf="successMessage">
          <span class="icon">‚úÖ</span>
          {{ successMessage }}
        </div>

        <form class="profile-form" (ngSubmit)="onSubmitEditProfile()">
          <div class="form-group">
            <label class="montserrat">Nome</label>
            <input type="text" class="form-input montserrat" [(ngModel)]="editForm.firstName" name="firstName" required>
          </div>
          <div class="form-group">
            <label class="montserrat">Sobrenome</label>
            <input type="text" class="form-input montserrat" [(ngModel)]="editForm.lastName" name="lastName" required>
          </div>
          <div class="form-group">
            <label class="montserrat">Email</label>
            <input type="email" class="form-input montserrat" [(ngModel)]="editForm.email" name="email" required>
          </div>
          <div class="form-group">
            <label class="montserrat">Telefone</label>
            <input type="tel" class="form-input montserrat" [(ngModel)]="editForm.phone" name="phone" required>
          </div>
          <div class="form-group">
            <label class="montserrat">Data de Nascimento</label>
            <input type="date" class="form-input montserrat" [(ngModel)]="editForm.dateOfBirth" name="dateOfBirth">
          </div>
          <div class="form-actions">
            <button type="button" class="cancel-btn montserrat" (click)="setActiveTab('profile')">
              Cancelar
            </button>
            <button type="submit" class="save-btn montserrat" [disabled]="isLoading">
              <span *ngIf="isLoading">‚è≥</span>
              {{ isLoading ? 'Salvando...' : 'Salvar Altera√ß√µes' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Add Address Tab -->
      <div class="tab-content" *ngIf="activeTab === 'add-address'">
        <h2 class="section-title cinzel">Adicionar Endere√ßo</h2>
        <form class="address-form">
          <div class="form-group">
            <label class="montserrat">Tipo de Endere√ßo</label>
            <select class="form-input montserrat" name="type">
              <option value="shipping">Entrega</option>
              <option value="billing">Cobran√ßa</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="montserrat">Rua</label>
              <input type="text" class="form-input montserrat" name="street">
            </div>
            <div class="form-group">
              <label class="montserrat">N√∫mero</label>
              <input type="text" class="form-input montserrat" name="number">
            </div>
          </div>
          <div class="form-group">
            <label class="montserrat">Complemento</label>
            <input type="text" class="form-input montserrat" name="complement">
          </div>
          <div class="form-group">
            <label class="montserrat">Bairro</label>
            <input type="text" class="form-input montserrat" name="neighborhood">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="montserrat">Cidade</label>
              <input type="text" class="form-input montserrat" name="city">
            </div>
            <div class="form-group">
              <label class="montserrat">Estado</label>
              <input type="text" class="form-input montserrat" name="state">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="montserrat">CEP</label>
              <input type="text" class="form-input montserrat" name="zipCode">
            </div>
            <div class="form-group">
              <label class="montserrat">Pa√≠s</label>
              <input type="text" class="form-input montserrat" name="country" value="Brasil">
            </div>
          </div>
          <div class="form-group checkbox-group">
            <input type="checkbox" id="isDefault" name="isDefault">
            <label for="isDefault" class="montserrat">Definir como endere√ßo padr√£o</label>
          </div>
          <div class="form-actions">
            <button type="button" class="cancel-btn montserrat" (click)="setActiveTab('addresses')">
              Cancelar
            </button>
            <button type="submit" class="save-btn montserrat">
              Salvar Endere√ßo
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer></footer>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p class="montserrat">Carregando seus dados...</p>
  </div>
</ng-template>
